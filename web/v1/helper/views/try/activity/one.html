<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link href="{ADMIN_THEME}images/reset.css" rel="stylesheet" type="text/css" />
    <link href="{ADMIN_THEME}images/system.css" rel="stylesheet" type="text/css" />
    <link href="{ADMIN_THEME}images/dialog.css" rel="stylesheet" type="text/css" />
    <link href="{ADMIN_THEME}images/switchbox.css" rel="stylesheet" type="text/css" />
    <link href="{ADMIN_THEME}images/table_form.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="{ADMIN_THEME}js/jquery.min.js"></script>
    <script type="text/javascript" src="{ADMIN_THEME}js/dialog.js"></script>
    <script type="text/javascript" src="{LANG_PATH}lang.js"></script>
    <script type="text/javascript" src="{ADMIN_THEME}js/core.js"></script>

    <link rel="stylesheet" type="text/css" href="/v1/helper/extensions/calendar/jscal2.css">
    <link rel="stylesheet" type="text/css" href="/v1/helper/extensions/calendar/border-radius.css">
    <link rel="stylesheet" type="text/css" href="/v1/helper/extensions/calendar/win2k.css">
    <script src="/v1/helper/extensions/calendar/calendar.js" type="text/javascript"></script>
    <script src="/v1/helper/extensions/language/zh-cn/calendar.js" type="text/javascript"></script>
    <script src="/v1/helper/views/admin/js/jquery-ui.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="extensions/kindeditor/kindeditor.js"></script>
    <script type="text/javascript" src="extensions/language/zh-cn/kindeditor.js"></script>
    <link rel="stylesheet" href="extensions/kindeditor/themes/default/default.css"/>
    <title>admin</title>
</head>
<body style="font-weight: normal;">
<div class="subnav">
    <div class="content-menu ib-a blue line-x">
        <a href="{url('try/activity/index')}"><em>{lang('a-list')}</em></a>
        <span>|</span>
        <a href="javascript:;" class="on"><em>{lang('a-edit')}</em></a>
    </div>
    <div class="bk10"></div>
    <div class="table-list">
        <form method="post" action="">
            <table width="100%" class="table_form">
                <tbody>
                <tr width="20%">
                    <th>商品详情：</th>
                    <td>
                        <table class="table-inner">
                            <tr><th>商品ID：</th>
                                <td>{$data['product']['productId']}</td></tr>
                            <tr><th>商品名称：</th>
                                <td>{$data['product']['productName']}</td></tr>
                            <tr><th>商品图片：</th>
                                <td><img src ="{$data['product']['smallImg']}" height="100"/></td></tr>
                            <tr><th>商品详情：</th>
                                <td>{$data['product']['productDes']}</td></tr>
                            <tr><th>市场价格：</th>
                                <td>{$data['product']['price']}</td></tr>
                            <tr><th>商品产地：</th>
                                <td>{$data['product']['madeIn']}</td></tr>
                            <tr><th>适用年龄：</th>
                                <td>{$data['product']['applyAge']}</td></tr>
                            <tr><th>上架状态：</th>
                                <td>{loop $statusList1 $k=>$v}
                                    <label for=""><input type="radio" name="productStatus" value="{$k}" {if $data['product']['status'] == $k}checked{/if}/> {$v} </label>
                                    {/loop}</td></tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <th>活动名称：</th>
                    <td><input type="text" id="activeName" class="input-text" size="50" name="activeName" value="{$data['activeName']}"/></td>
                </tr>
                <tr>
                    <th>主图：</th>
                    <td>
                        <div class="upload">
                            <input class="ke-input-text input-text" type="text" size="50" name="tryOutDetailImg" id="tryOutDetailImg" value="{$data['tryOutDetailImg']}" />
                            <input type="button" id="uploadButton1" value="上传"
                                   data-url="{url('attachment/alioss_file',array('size'=>50,'type'=>urlencode(base64_encode('img,gif,jpg,jpeg') )))}" />
                        </div>
                        <div class="ke-dialog-loading-content hidden" >上传中，请稍候 ...</div>
                    </td>
                </tr>
                <tr>
                    <th>附图：</th>
                    <td>
                        <div class="upload">
                            <input class="ke-input-text input-text" type="text" size="50" name="tryOutDetailPastImg" id="tryOutDetailPastImg" value="{$data['tryOutDetailPastImg']}" />
                            <input type="button" id="uploadButton2" value="上传"
                                   data-url="{url('attachment/alioss_file',array('size'=>50,'type'=>urlencode(base64_encode('img,gif,jpg,jpeg') )))}" />
                        </div>
                        <div class="ke-dialog-loading-content hidden" >上传中，请稍候 ...</div>
                    </td>
                </tr>
                <tr>
                    <th>活动开始（申请试用）时间：</th>
                    <td><input type="text" id="startTime" class="input-text date" name="startTime" value="{date('Y-m-d H:i:s',$data['startTime'])}"/></td>
                </tr>
                <tr>
                    <th>申请结束时间：</th>
                    <td><input type="text" id="applyEndTime" class="input-text date" name="applyEndTime" value="{date('Y-m-d H:i:s',$data['applyEndTime'])}"/></td>
                </tr>
                <tr>
                    <th>审核结束时间：</th>
                    <td><input type="text" id="releaseTime" class="input-text date" name="releaseTime" value="{date('Y-m-d H:i:s',$data['releaseTime'])}"/></td>
                </tr>
                <tr>
                    <th>活动结束（回收报告）时间：</th>
                    <td><input type="text" id="deadTime" class="input-text date" name="deadTime" value="{date('Y-m-d H:i:s',$data['deadTime'])}"/></td>
                </tr>
                <tr>
                    <th>试用商品数量：</th>
                    <td><input type="text" class="input-text" name="totalNum" value="{$data['totalNum']}"/></td>
                </tr>
                <tr>
                    <th>已发件数：</th>
                    <td><input type="text" class="input-text" name="sendNum" readonly value="{if $data['tryCount']}{$data['sendNum']}{else}0{/if}"/></td>
                </tr>
                <tr>
                    <th>试用人数：</th>
                    <td><input type="text" class="input-text" name="tryCount" readonly value="{if $data['tryCount']}{$data['tryCount']}{else}0{/if}"/></td>
                </tr>
                <tr>
                    <th>报告人数：</th>
                    <td><input type="text" class="input-text" name="reportCount" readonly value="{if $data['tryCount']}{$data['reportCount']}{else}0{/if}"/></td>
                </tr>
                <tr>
                    <th>活动状态：</th>
                    <td>{loop $statusList $k=>$v}
                        <label for=""><input type="radio" name="status" value="{$k}"  {if $data['status']==$k}checked{/if}/>{$v}</label>
                    {/loop}</td>
                </tr>
                <tr>
                    <th>添加时间：</th>
                    <td>{date('Y-m-d H:i:s',$data['createTime'])}</td>
                </tr>
                <tr>
                    <th></th>
                    <td><input type="button" value="提交"/></td>
                </tr>
                </tbody>
            </table>
        </form>
    </div>
</div>
<script type="text/javascript">
    KindEditor.ready(function(K) {
        //主图
        var url = K('#uploadButton1').attr('data-url');
        var uploadbutton1 = K.uploadbutton({
            button: K('#uploadButton1')[0],
            fieldName: 'file',
            url: url,
            afterUpload: function (data) {
                if (data.error == 0) {
                    var url = K.formatUrl(data.filename, 'absolute');
                    K('#tryOutDetailImg').val(url);
                    $('.ke-dialog-loading-content').hide();
                } else {
                    alert(data.result);
                }
            },
            afterError: function (str) {
                //console.log('错误信息: ' + str);
            }
        });
        uploadbutton1.fileBox.change(function(e) {
            $(this).parents('.upload').siblings('.ke-dialog-loading-content').show();
            uploadbutton1.submit();
        });
        //附图
        var url =  K('#uploadButton2').attr('data-url');
        var uploadbutton2 = K.uploadbutton({
            button : K('#uploadButton2')[0],
            fieldName : 'file',
            url : url,
            afterUpload : function(data) {
                if (data.error == 0) {
                    var url = K.formatUrl(data.filename, 'absolute');
                    K('#tryOutDetailPastImg').val(url);
                    $('.ke-dialog-loading-content').hide();
                } else {
                    alert(data.result);
                }
            },
            afterError : function(str) {
                //console.log('错误信息: ' + str);
            }
        });
        uploadbutton2.fileBox.change(function(e) {
            $(this).parents('.upload').siblings('.ke-dialog-loading-content').show();
            uploadbutton2.submit();
        });
    });
    //
    Calendar.setup({
        weekNumbers : true,
        inputField  : "startTime",
        trigger     : "startTime",
        dateFormat  : "%Y-%m-%d %H:%M:%S",
        showTime    : true,
        minuteStep  : 1,
        onSelect    : function() {
            this.hide();
//                var time = $("#start_time").val();
//                var date = (new Date(Date.parse(time.replace(/-/g,"/")))).getTime() / 1000;
//                $("#start_time").val(date);
        }
    });
    Calendar.setup({
        weekNumbers : true,
        inputField  : "applyEndTime",
        trigger     : "applyEndTime",
        dateFormat  : "%Y-%m-%d %H:%M:%S",
        showTime    : true,
        minuteStep  : 1,
        onSelect    : function() {
            this.hide();
        }
    });
    Calendar.setup({
        weekNumbers : true,
        inputField  : "releaseTime",
        trigger     : "releaseTime",
        dateFormat  : "%Y-%m-%d %H:%M:%S",
        showTime    : true,
        minuteStep  : 1,
        onSelect    : function() {
            this.hide();
        }
    });
    Calendar.setup({
        weekNumbers : true,
        inputField  : "deadTime",
        trigger     : "deadTime",
        dateFormat  : "%Y-%m-%d %H:%M:%S",
        showTime    : true,
        minuteStep  : 1,
        onSelect    : function() {
            this.hide();
        }
    });

    $('form').submit(function(){return false;});
    $(':button:last').on('click',function(){
        var form = $(this).parents('form');
        $.post(form.attr('action'),form.serialize(),function(json){
//            console.log(json);
            alert(json.info);
            if(json.code){
                history.go(-1);
            }else{
                location.href="";
            }
        },'json');
    });
</script>
</body>
</html>
